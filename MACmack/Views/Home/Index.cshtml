@model MACmack.Models.ServiceTypeViewModel
@{
    ViewData["Title"] = "MAConomen anställda";
}

<div class="boxcontainer container">
    <table id="myTable">
        <tr>
            <th>Registreringsnummer</th>
            <th>Servicetyp</th>
            <th>Status</th>
        </tr>
    </table>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
    $(document).ready(function() {
        var ws = new WebSocket("ws://127.0.0.1:8000/employee");
        ws.onopen = function() {

        }

        ws.onmessage = function(evt) {
            //alert("onmessage!");
            var rec = evt.data;

            //alert("evt : " + rec);
            //console.log(rec);

            var splitArray = rec.split(',');

            var regnr = splitArray[0];
            var serviceType = splitArray[1];

            var table = document.getElementById("myTable");

            var row = table.insertRow(1);

            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);

            cell1.innerHTML = regnr;
            cell2.innerHTML = serviceType;
            cell3.innerHTML = "<button class='statusButton' id='" + regnr + "'>Redo!</button>";

            //Name buttons

            var newButton = document.getElementById(regnr);

            newButton.addEventListener('click', function() {
                //switch status in table
                var cell = document.getElementById(this.id).parentElement;

                cell.innerHTML = "Pågående!!";

                var message = this.id.toString();

                
                ws.send(message);
            });
        }
    });

    

</script>

